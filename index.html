{% extends "base.html" %}

{% block title %}Главная - IT BookShelf{% endblock %}

{% block content %}
<div class="header-actions">
    <div class="sort-controls">
        <span>Сортировка:</span>
        <a href="{{ url_for('index', sort_by='title', order='ASC') }}" 
           class="btn btn-sm {% if sort_by == 'title' and order == 'ASC' %}active{% endif %}">
            По названию (А-Я)
        </a>
        <a href="{{ url_for('index', sort_by='added_date', order='DESC') }}" 
           class="btn btn-sm {% if sort_by == 'added_date' and order == 'DESC' %}active{% endif %}">
            Новые сначала
        </a>
        <a href="{{ url_for('index', sort_by='rating', order='DESC') }}" 
           class="btn btn-sm {% if sort_by == 'rating' and order == 'DESC' %}active{% endif %}">
            По рейтингу
        </a>
    </div>
</div>

{% if books %}
<div class="books-grid">
    {% for book in books %}
    <div class="book-card">
        <div class="book-cover">
            {% if book.cover_path %}
                <img src="{{ url_for('serve_uploaded_file', filename=book.cover_path.split('uploads/')[-1]) }}" 
                     alt="{{ book.title }}">
            {% else %}
                <div class="cover-placeholder">
                    <i class="fas fa-book-open"></i>
                </div>
            {% endif %}
            
            <div class="book-progress">
                <div class="progress-bar" style="width: {{ book.progress }}%"></div>
                <span>{{ book.progress }}%</span>
            </div>
        </div>
        
        <div class="book-info">
            <h3>{{ book.title }}</h3>
            
            {% if book.author %}
            <p class="book-author">
                <i class="fas fa-user"></i> {{ book.author }}
            </p>
            {% endif %}
            
            <p class="book-meta">
                <i class="fas fa-file"></i> {{ book.file_type|upper }}
                <span class="separator">•</span>
                <i class="fas fa-hdd"></i> {{ (book.file_size / 1024 / 1024)|round(2) }} MB
            </p>
            
            {% if book.tags_array %}
            <div class="book-tags">
                {% for tag in book.tags_array %}
                <span class="tag">{{ tag }}</span>
                {% endfor %}
            </div>
            {% endif %}
            
            <div class="book-actions">
                <a href="{{ url_for('read_book', book_id=book.id) }}" class="btn btn-primary">
                    <i class="fas fa-book-reader"></i> Читать
                </a>
                <a href="{{ url_for('view_book', book_id=book.id) }}" class="btn btn-secondary">
                    <i class="fas fa-info-circle"></i> Подробнее
                </a>
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<div class="empty-state">
    <i class="fas fa-books fa-4x"></i>
    <h2>Библиотека пуста</h2>
    <p>Добавьте свою первую IT-книгу!</p>
    <a href="{{ url_for('upload_book') }}" class="btn btn-primary btn-lg">
        <i class="fas fa-plus"></i> Добавить книгу
    </a>
</div>
{% endif %}

<div class="stats-bar">
    <div class="stat-item">
        <span class="stat-number">{{ books|length }}</span>
        <span class="stat-label">Всего книг</span>
    </div>
    <div class="stat-item">
        <span class="stat-number">
            {{ books|selectattr('progress', 'equalto', 100)|list|length }}
        </span>
        <span class="stat-label">Прочитано</span>
    </div>
    <div class="stat-item">
        <span class="stat-number">
            {{ (books|sum(attribute='file_size') / 1024 / 1024)|round(2) }} MB
        </span>
        <span class="stat-label">Общий размер</span>
    </div>
</div>
{% endblock %}
